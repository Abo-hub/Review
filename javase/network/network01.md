# 网络基础知识

1. 物理层
2. 链路层
3. 网络层
4. 传输层
5. 应用层


## 概述
网络把主机连接起来，而互联网是把多种不同的网络连接起来，因此互联网是网络的网络。
### ISP
互联网服务提供商ISP可以从互联网管理机构获得许多IP地址，同时拥有通信线路以及路由器等互联网设备，个人或机构向ISP缴纳一定的费用就可以接入或联网。

### 电路交换与分组交换
#### 电路交换
电路交换用于电话通信系统，两个用户要通信之前需要简历一条专用的物理链路，并且在整个通信过程中始终占用该链路。由于通信的过程不可能一直在使用传输线路，因此电路交换对线路的利用很低，往往不到10%。

#### 分组交换
每个分组都有首部和尾部，包含了源地址和目的地址等控制信息，在同一个传输线路上同时传输多个互相不会影响，因那次在同一条传输线路上允许同时传递多个分组，也就是分组交换不需要战越勇传输线路。

在一个邮局通信系统中，邮局收到一份邮件之后，先存储下来，然后把想用目的地邮件转发到下一个目的地，这个过程就是存储转发过程，分组交换也使用了存储转发过程。

#### 时延
总时延 = 排队时延+处理时延+传输时延+传播时延

##### 排队时延
分组在路由器地输入队列和输出队列中排队等待地时间，取决于网络当前地通信量。

##### 处理时延
主机或路由器收到分组时进行处理所需要地时间，例如分析首部、从分组中提取数据、进行差错检验或查找适当地路由等

##### 传输时延
主机或路由器传输数据帧所需要地时间
$$
delay=l(bit) / v(bit/s)
$$
其中l表示数据帧地长度，v表示传输速率

##### 传播时延
电磁波在信道传播所需要花费地时间，电磁波传播地速度接近光速
$$
delay=l(m)/v(m/s)
$$
其中l表示信道长度，v表示电磁波在信道上地传播速度


### 计算机网络体系结构

![net1](/imgs/net1.png)

#### 五层协议
- 应用层：为特定应用程序提供数据传输服务，例如HTTP、DNS等协议。数据单位为报文。
- 传输层：为进程提供数据传输服务，由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。运输层包括两种协议：传输控制协议TCP，提供面向连接可靠的数据传输服务，数据单位为报文段；用户数据协议UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP主要提供完整性服务，UDP主要提供及时性服务。
- 网络层：为主机提供数据传输服务。而传输层协议是为主机中的进程的提供数据传输服务。网络层把传输层传递下来的报文段或者用户数据封装称分组。
- 数据链路层：网络成针对的还是主机之间的数据出书服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供传输服务。数据链路层把网络层传下来的分组封装成帧。
- 物理层：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。

#### OSI
- 表示层：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。
- 会话层：建立及管理会发

五层协议美亚由表示层和会话层，而是将这些功能留给应用程序或者开发处理

#### TCP/IP
只有四层相当于五层协议中数据链路层和物理层合并为网络接口层。

### 数据在各层之间的传递过程
在向下的过程中，许哟啊添加下层协议所需要的首部和尾部，而在向上的过程中不断拆开首部和尾部。

路由器只有下面三层协议，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要传输层和应用层。









## 一、物理层

### 通信方式
跟据信息在传输线上的传送方向分为以下三种通信方式：
- 单工通信：单向传输
- 半双工通信：双向交替传输
- 全双工通信：双向同时传输

### 带通调制
模拟信号是连续的信号，数字信号是离散的信号。带通调制就是把数字信号转换为模拟信号。





## 二、链路层
### 基本问题
#### 1. 封装成帧
将网络层传下来的分组添加首部和尾部，用于标记帧的开始和结束
![zhen](/imgs/zhen.png)

#### 2. 透明传输
透明表示一个实际存在的事物看起来好像不存在一样

帧首部和尾部进行定界，如果帧的数据部分含有和首部尾部相同的内容，那么真的额开始和结束位置就会被错误判定。需要在数据部分出现首部尾部相同的内容插入转义字符。如果数据部分出现转义字符，那么就在转义字符前面再加个转义字符。在接收端进行处理之后可以以还原出原始数据。这个过程透明传输的内容是转义字符。用户察觉不到转义字符的存在。
![touming](/imgs/touming.png)

#### 3. 差错检查
目前数据链路层广泛使用了循环冗余检验(CRC)来检查比特差错

### 信道分类
#### 1. 广播信道
一对多通信，有一个节点发送的数据能被广播信道所偶的节点接收到

所有的节点都在同一个广播信道上发送数据，因此需要有专门的控制方法进行协调，避免发生冲突(冲突也叫碰撞)

主要有两种控制方法进行协调，一个是使用信道复用技术，一是使用CSMA/CD协议

#### 2. 点对点信道
一对一通信
因为不会发生碰撞，因此也比较简单，使用PPP协议进行控制

### 信道复用技术
#### 1. 频分复用
频分复用的所有主机在相同的时间占用不同的频率带宽资源
![fuong](/imgs/fuyong.png)

#### 2. 时分复用
时分复用的所有主机在不同的时间占用相同的频率带宽资源
![shifen](/imgs/shifen.png)
使用频分复用和时分复用进行通信，在通信的过程中主机会一直占用一部分信道资源。但是由于计算机数据的突发性质，通信过程没必要一直占用信道资源而不让给其他用户使用，因此这两种方式对信道的利用率都不高

#### 3. 统计时分复用
是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就几种起来组成统计时分复用帧然后发送
![tongji](/imgs/tongji.png)

#### 4. 波分复用
光的频分复用。由于光的频率很高，因此习惯上用波长而不是频率来表示所使用的光载波。

### MAC地址
MAC地址是链路层地址，长度为6字节(48位)，用于唯一标识网络适配器(网卡)

一台主机拥有多个网络适配器就拥有多少个MAC地址。例如笔记本普遍存在无线网络适配器和无线网络适配器，因此就有两个MAC地址。

### 局域网
局域网是一种典型广播信道，主要特点是网络为一个单位所拥有，且地理位置范围和站点数据均有限

主要有以太网、令牌环网、FDDI和ATM等具局域网技术，目前以太网占领着有线局域网市场。

## 三、网络层
### 概述
因为网络层是整个互联网网的核心，因此应当让网络层尽可能简单。网络层向上只提供简单灵活的、无连接的、尽最大努力交互的数据报服务。

使用IP协议，可以把异构的物理网络连接起来，使得在网络层看起来好像是一个同意的网络。

与IP协议配套使用的还有三个协议：
- 地址解析协议APP(Address Resolution Protocol)
- 网际控制报文协议ICMP(Internet Control Message Protocl)
- 网际组管理协议IGMP(Internet Group Management Protocol)

### IP数据包格式
![IP](/imgs/IP.png)
- 版本：有4(IPv4)和6(IPv6)两个值；
- 首部长度：占4位，因此最大值为15.值为1表示的是1个32位字的长度，也就是4个字节。因为固定部分长度位20字节，因此该值最小位5。如果可选字段的长度不是4字节的整数倍，就用尾部的填充部分来填充。
- 区分服务：用来获得更好的服务，一般情况下不使用
- 总长度：包括首部长度和数据部分长度
- 身存时间：TTL，它的存在是为了防止无法交付的数据包在互联网中不断兜圈子。以路由器跳数为单位，当TTL为0时就丢失数据报
- 协议：指出携带的数据应该上交给哪个协议进行处理，例如ICMP、TCP、UDP
- 首部检验和：因为数据包每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量
- 标识：在数据包长度过长从而发生分片的情况下，相同数据包的不同分片具有相同的标识符
- 片偏移：和标识符也一起，用于发生分片的情况。片偏移的单位8字节
![ppy](/imgs/ppy.png)

## IP资质编址方式
IP地址的编址方式经历了三个历史阶段：
- 分类
- 子网划分
- 无分类

### 分类
由两部分组成，网络号和主机号，其中不同分类具有不同的网络号长度，并且是固定的

IP地址::={<网络号>,<主机号>}

![ipfl](/imgs/ipfl.png)

### 子网划分
通过主机号字段中拿一部分作为子网号，把两级IP地址划分为三级IP地址

IP地址::={<网络号>,<子网号>，<主机号>}

要使用子网，必须配置子网掩码。一个B类地址的默认子网掩码为255.255.0.0，如果B类地址的子网占两个比特，那么子网掩码为11111111 11111111 11000000 00000000，也就是255.255.192.0

> 注意，外部网络看不到子网的存在

### 无分类
无分类编址CIDR消除了传统A类、B类和C类地址以及划分子网的概念，使用网络前缀和主机号来对IP地址进行编码，网络前缀的长度可以根据需要变化
IP 地址 ::= {< 网络前缀号 >, < 主机号 >}
CIDR的记法上采用在IP地址后面加上网络前缀长度的方法，例如128.14.35.7/20表示前20位为网络前缀

CIDR的地址掩码可以继续称为子网掩码，子网掩码首长度1为网络前缀的长度

一个CIDR地址块中有很多地址，一个CIDR表示的网络就可以表示原来的很多个网络，并且在路由表中只需要一个路由就可以代替原来的多个路由，减少了路由表项的数量。把这种通过使用网络前缀来减少路由表项的方式称为路由聚合，也称为构成超网

在路由表中的项目由“网络前缀”和“下一跳地址”组成，在查找时可能会得到不止一个匹配结果，应当采用最长前缀匹配来确定应该匹配哪一个。





## 传输层
网络层只把分组发送到目的主机，但是真正通信的并不是主机而是主机中的进程。传输层提供了进程间的逻辑通信，传输层向高层用户屏蔽了下面网络层的核心细节，使应用程序看起来像是两个传输层实体之间有一条端到端的逻辑通信信道

UDP和TCP的特点
用户数据报协议UDP(User Datagram Protocol)
- 面向非连接
- 不维护连接状态，支持同时向多个客户端传输相同的消息
- 数据包报头只有8个字节，额外开销较小
- 吞吐量只受限于数据生成速率、传输速率以及机器性能
- 尽最大努力交付，不保证可靠交付，不需要维持复杂的连接状态表
- 面向报文，不对应用程序提交的报文信息进行拆分或者合并

传输控制协议TCP(Transmission Control Protoclo)
- 面向连接
- 提供可靠交付，有流量控制，拥塞控制，提供全双工通信
- 面向字节流(把应用层传下来的报文看成字节流，把字节流组织成大小不同的数据块)，
- 每一条TCP连接只能是点对点的(一对一)

### UDP首部格式
![udp](/imgs/udp.png)
首部字段只有8个字节，包括源端口、目的端口、长度、检验和。12字节的伪首部是为了计算校验和临时添加的。







### TCP
![tcp](/imgs/tcp.png)

- 序号：用于对字节流进行编号，例如序号301，表示第一个字节的编号为301，如果携带的数据长度为100字节，那么下一个报文段的序号应为401
- 确认号：期望收到的下一个报文段的序号。例如B正确收到A发送来的一个报文段，序号为501，携带的数据长度为200个字节，因此B希望下一个报文段的序号为701，B发送给A的确认号九尾701
- 数据偏移：指的是数据部分举例报文段起始处的偏移量，实际上值得是首部的长度
- 确认ACK：当ACK=1时确认号字段有效，否则无效。TCP规定，在连接建立后所以有传送的报文段必须把ACK置1
- 同步SYN：在连接建立时用来同步序号。当SYN=1，ACK=0时表示这是一个连接请求报文段。若对方同意建立连接，则响应报文中SYN=1，ACK=1
- 中止FIN：用来释放一个连接，当FIN=1时，表示此报文段的发送方的数据已发送完毕，并要求释放连接
- 窗口：窗口值作为接收方让发送方设置其发送窗口的依据。之所以要有这个限制，是因为接收方的数据缓存空间是有限的。


#### TCP Flags
- URG：紧急指针标志
- ACK：确认序号标志
- PSH：push标志
- RST: 充值连接标志
- SYN：同步序列号，用于建立连接过程
- FIN：finish标志，用于释放连接


### TCP的三次握手
![woshou](/imgs/woshou.png)
假设A为客户端，B为服务端
- 首先B处于LISTEN(监听)状态，等待客户端的连接请求
- A向B发送请求连接报文，SYN=1，ACK=0，选择一个初始的序号x
- B收到连接请求报文，如果同意建立连接，则向A发送连接确认报文，SYN=1，
ACK=1，确认号为x+1,同时也选择一个初始的序号y
- A收到B的连接确认报文后，还要向B发出确认，确认号为y+1,序号为x+1
- B收到A的确认后，连接建立

**三次握手的原因**
第三次握手时为了防止失效的连接请求到达服务器，让服务器错误打开连接。

客户端发送的连接请求如果在网络中滞留，那么就会很长时一端时间才能收到服务端发挥的连接请求。客户都安等待一个超时重传时间之后，就会重新请求连接。但是这个滞留的连接请求最后还是会到达服务器，如果不进行三次握手，那么服务器就会打开两个连接。如果有第三次握手，客户端就会忽略服务器之后发送的对滞留连接请求的连接确认，不进行第三次握手，因此就不会再次打开连接。


**首次握手的隐患---SYN超时**
问题起因分析
- Server收到Client的SYN，回复SYN-ACK的时候未收到ACK确认
- Server不断重试至超时，Linux默认等待63才断开连接

针对SYN Flood的保护措施
- SYN队列满后，通过tcp_syncookies参数回发SYN Cookie
- 若为正常连接则Client会回发SYN Cookie，直接建立连接

建立连接后，Client出现出现故障怎么办
保活机制
- 向对方发送保活探测报文，如果未收到响应则继续发送
- 尝试次数达到保活探测数仍未收到响应则终端连接

#### TCP的四次挥手
![four](/imgs/four.png)

- A发送连接释放报文FIN=1
- B收到之后发出确认，此时TCP属于半关闭状态，B能向A发送数据但是A不能向B发送数据
- 当B不再需要连接时，发送连接释放报文FIN=1
- 当A收到后发出确认，进入TIME-WAIT状态，等待2MSL(最大报文存活时间后释放连接)
- B收到A的确认后释放连接

> 百度百科
>tcp四次挥手，由于TCP连接时全双工的，因此每个方向都必须单独进行关闭
>这个原则是当一方完成它的数发送任务就能发送一个FIN来中止这个方向的连接。收到一个FIN只以为者这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。
> 1. 客户端A发送一个FIN，用来关闭客户端A到服务器B的数据传送
> 2. 服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1.和SYN一样，一个FIN将占用一个序号。
> 3. 服务器B关闭与客户端A的李连杰，发送一个FIN给客户端A
> 4. 客户端A发回ACK报文确认，并将确认号设置为收到序号加1


##### 四次挥手的原因
客户端发送了FIN连接释放报文后，服务器收到了这个报文，就进入CLOSE-WAIT状态。这个状态是为了让服务器发送还未传送完毕的数据，传送完毕之后，服务器会发送FIN连接释放报文。

##### 为什么有TIME_WAIT状态
客户端收到服务端的FIN报文后进入此状态，此时并不是直接进入CLOSED状态，还需要要等待一个时间计时器设置的时间2MLS。这么做有两个原因
- 确保最后一个确认报文能够达到。如果B没收到A发送来的确认报文，那么就会重新发送连接释放请求报文，A等待一段时间就是为了处理这种情况的发生 
- 等待一段时间是为了让本连接持续时间内所产生的所有报文都从网络中消失，使得下一个新的连接不会出现旧的连接请求报文。

##### 可靠传输
TCP使用了超时重传实现可靠传输：如果一个已经发送的报文段在超时时间内没有受到确认，那么就重传这个报文段。

一个报文段发送到接收到确认所经过的时间称为返回时间RTT，加权平均返回时间RTTs就按如下
$$
RTTs=(1-a)*(RTTs)+a*RTT
$$

其中，0<=a<1,RTTs随着a的增加容易受到RTT的影响。
超时时间RTO应该略大于RTTs，TCP使用的超时时间计算如下：
$$
RTO=RTTs+4*RTTd
$$

其中RTT为偏差的加权平均值

##### TCP滑动窗口
窗口时缓存的一部分，用来暂时存放字节流。发送方和接收方各有一个窗口，接收方通过TCP报文段中的窗口文段告诉发送方自己的窗口大小，发送方根据这个值和其他信息设置的窗口大小

发送窗口内的字节都允许被发送，接收窗口内的字节都允许被接收，如果发送窗口做不的字节已经发送并且收到了确认，那么就将发送窗口向右滑动一定距离，直到左部第一个字节不是发送并且已确认的状态；接收窗口的华东类似，接收窗口做不字节已经发送确认并交付主机，就向右华东接收窗口。

接收窗口只会对窗口内最后一个按序到达的字节进行确认，例如接收窗口受到的字节为{31,34,35},其中{31}按序到达，而{34，35}就不是，因此只对字节31进行确认。发送方得到一个字节的确认之后，就直到这个字节之前的所有字节都已被接收。

![hudogn](/imgs/hudong.jpg)





## 应用层
### 域名系统
DNS是一个分布式数据库，提供了域名和IP地址之间相互转换的服务。这里的分布式数据库是指，每个站点只保留他自己的那部分数据。

域名具有层次结构，从上到下以此为：根域名、顶级域名、二级域名
![yuming](/imgs/yuming.jpg)

DNS 可以使用UDP或者TCP进行传输，使用的端口都为53。大多数情况下DNS使用UDP进行传输，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性。在这两种情况下使用TCP进行传输：
- 如果返回的响应超过512字节(UDP最大支持512字节的数据)
- 区域传送(区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据)

### 文件传送协议
FTP使用TCP进行连接，它需要两个连接来传送一个文件：
- 控制连接: 服务器打开端口号21等待客户端的连接，刻划断主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答。
- 数据连接：用来传送一个文件数据

根据数据连接是否是服务器端主动建立，FTP有主动和被动两种模式：
- 主动模式：服务器端主动建立数据连接，其中服务器端的端口号为20，客户端的端口号随机，但是必须大于1024，因为0-1023是熟知端口号
- 被动模式：客户端主动建立数据连接，其中客户端的端口号由客户端自己指定，服务端的端口号随机

主动模式要求客户端开放端口号给服务端，需要去配置客户端的防火墙。被动模式只需要服务器端开放端口号即可，无需客户端配置防火墙。但是被动模式会导致服务端的安全性减弱，因为开放了过多的端口号。

### 动态主机配置协议
DHCP(Dynamic Host Configuration Protocol)提供了即插即用的联网方式，用户不再需要受到配置IP地址等信息。

DHCP 配置的内容不仅是IP地址，还包括子网掩码、网关IP地址。

DHCP工作过程如下：
1. 客户端发送Discover报文，该报文的目的地址为255.255.255.255:67,源地址为0.0.0.0：68，被放入UDP中，该报文被广播到同一个子网的所有主机上。如果客户端和DHCP服务器不在用一个子网，就需要使用中继续代理。
2. DHCP 服务器受到Discover报文之后，发送Offer报文给客户端，改变报文包含了客户端所需要的信息。因为客户端可能受到多个DHCP服务器提供的信息，因此客户端需要进行选择。
3. 如果客户端选择了某个DHCP服务器提供的信息，那么就发送Request报文给该DHCP服务器。
4. DHCP 服务器发送Ack报文，表示客户端此时可以使用提供给他的信息。
![dhcp](/imgs/dhcp.jpg)

### 远程登录协议
TELNET 用于登录都远程主机上，并且远程主机上的输出也会返回

TELNET 可以适应许多计算机和操作系统的差异，例如不同操作系统的换行符定义

### 电子邮件协议
一个电子邮件系统由三部分组成：用户代理、邮件服务器以及邮件协议
邮件协议包含发送协议和读取协议，发送协议常用SMTP，读取协议常用POP3和IMAP。

![email](/imgs/email.jpg)

### SMTP
SMTP 只能发送ASCII码，而互联网邮件扩充MIME可以发送二进制文件。MIME并没有改动或者取代SMTP，而是增加邮件主题的结构，定义了非ASCII码的编码规则。
![stpm](/imgs/stpm.png)

### POP3
POP3 的特点是只要用户从服务器上读取了邮件，就把该邮件删除。但最新版本POP3可以不删除邮件



### Web页面请求过程
#### 1. DHCP 配置主机
- 假设主机最开始没有IP地址以及其他信息，那么就需要使用DHCP来获取。
- 主机生成一个DHCP请求报文，并将这个报文放入具有目的端口67和源端口68的UDP报文段中。
- 该报文端则被放入一个具有广播IP目的地址(255.255.255.255)和源IP地址的UDP报文段中。
- 该数据报被放置在MAC帧中，该帧具有目的地址FF:FF:FF:FF:FF:FF，并将广播到与交换机连接的所有设备。
- 连接在交换机的DHCP服务器受到广播帧之后，不断地向上分解得到IP数据报、UDP报文段、DHCP请求报文，之后生成DHCP ACK报文，该报文含有以下信息：IP地址、DNS服务器的IP地址、默认网关的IP地址和子网掩码。该报文段被放入UDP报文段中，UDP报文段有被放入IP数据报中，最后放入MAC帧中。
- 该帧的目的地址是请求主机的MAC地址，因为交换机具有自学习能力，之前主机发送了广播帧之后就记录了MAC地址到其转发接口的交换表项，因此现在交换机就可以直到向哪个接口发送该帧。
- 主机受到该帧后，不断分解得到DHCP报文。之后就配置它的IP地址、子网掩码和DNS服务器的IP地址，并在其IP转发表中安装默认网关。
- 主机收到该帧后，不断分解得到DHCP报文。之后就配置它的IP地址、子网掩码和DNS服务器的IP地址，并在其IP转发表中安装默认网关。

#### 2. ARR解析MAC地址
- 主机通过浏览器生成一个TCP套接字，套接字向HTTP服务器发送HTTP请求。为了生成该套接字，主机需要知道网站的域名对应的IP地址。
- 主机生成一个DNS查询报文，该报文具有53号端口，因为DNS服务器的端口号是53
- 该DNS查询报文被放入目的地址为DNS服务器IP地址的IP数据报中
- 该IP数据报被放入一个以太网帧中，该帧将发送到网关路由器。
- DHCP过程只知道网关路由器的IP地址，为了获取网关路由器的MAC地址，需要使用ARR协议
- 主机生成一个包含目的地址为网关路由器IP地址ARP查询报文，将该ARP查询报文放入一个具有广播目的地址(FF:FF:FF:FF:FF:FF)的以太网帧中，并向交换机发送该以太网帧，交换机将该帧发给所有的连接设备，包括网关路由器。
- 网关路由器接收到该帧后，不断向上分解得到ARP报文，发现其中的IP地址与其接口的IP地址匹配，因此就发送一个ARP回答报文，包含了它的MAC地址，发回给主机。

#### 3. DNS解析域名
- 知道了网关路由器的MAC地址后，就可以继续DNS的解析过程了
- 网关路由器接收到包含DNS查询报文的以太网帧后，抽取出IP数据包，并根据转发表决定该IP数据报应该转发的路由器
- 因为路由器具有内部网关协议(RIP、OSPF)和外部网关协议(BGP)这两种路由选择协议，因此路由表中已经配置了网关路由器到达DNS服务器的路由表项。
- 到达DNS服务器之后，DNS服务器抽取出DNS查询报文，并在DNS数据库中查找待解析的域名
- 找到DNS记录之后，发送DNS回答报文，将该回答报文放入UDP报文段中，然后放入IP数据报中，通过路由器反向发送回网关路由器，并经过以太网交换机到达主机

#### 4. HTTP请求页面
- 有了HTTP请求的IP地址后，主机就能够生成TCP套接字将用于向Web服务器发送了HTTP GET报文
- 在生成TCP套接字之前，必须先与HTTP服务器进行三次握手来建立连接。生成一个具有目的端口80的TPC SYN 报文段，并向HTTP 服务器发送该报文段。
- HTTP服务器收到该报文段之后， 生成TCP SYN ACK 报文段，发送回主机
- HTTP连接建立后，浏览器生成HTTP GET 报文，并交付个HTTP服务器
- HTTP服务器从TCP套接字读取HTTP GET 报文，生成一个HTTP响应报文，将Web页面内容放入报文主题中，发回给主机
- 浏览器手动HTTP响应报文后，抽取出Web页面内容，之后进行渲染，显示Web页面





为什么需要四次挥手才能断开连接
因为TCP是全双工通信，发送方和接收方都需要FIN报文和ACK报文



TCP和UDP的区别
- TCP面向连接；UDP无连接
- TCP有可靠性；UDP不保证
- TCP利用序列号保证了顺序交付；UDP不具备有序性
- 速度 TCP<UDP (TCP需要建立连接保证消息的可靠性和有序性；UDP传输速度块，可用于在线视频媒体、电视广播、多人游戏)
- 量级 TPC 20个字节  UDP：8个字节


TCP的互动窗口
RTT和RTO
- RTT：发送一个数据包到收到对应的ACK，所花费的时间
- RTO：重传时间间隔
 
TCP使用华东窗口做流量控制与乱序重排
- 保证TCP的可靠性
- 保证TCP的流控特性

Socket简介
Socket是对TCP/IP协议的抽象，是操作系统对外开放的接口



## 面试题
1. 在浏览器地址栏输入URL，按下回车之后经历的流程
- DNS解析(解析url中的ip地址)
- 建立TCP连接(TCP三次握手)
- 发送HTTP请求
- 服务器处理请求并返回HTTP报文
- 浏览器解析渲染页面
- 连接结束 (TCP四次挥手)

2. HTTP状态码
- 1xx: 指示信息--表示请求已接受，继续处理
- 2xx：成功--表示请求以被成功接受
- 3xx：重定向--要完成请求必须进行更进一步的操作
- 4xx: 客户端错误--请求有语法错误或请求无法实现
- 5xx: 服务器端错误--服务器未能实现合法的请求

常用状态码
| 状态码 | 含义 |
| -- | -- |
| 200 OK | 成功 |
| 400 Bad Request | 请求报文中存在语法错误 |
| 401 Unauthorized | 请求需要有同故宫HTTP认证的认证消息。另外如果之前已经进行一次请求，则表示用户认证失败 | 
| 403 Forbidden | 对请求资源的访问被服务器拒绝了，如未获得文件系统的访问授权，访问权限出现某些问题 |
| 404 Not Found | 服务器上没有请求的资源 |
| 500 Internal Server Error | 服务器在执行请求发生了错误，BUg或临时故障 |
| 503 Server Unavaliable | 服务器暂时处于超负荷正在进行停机维护，现在无法处理请求 | 

2. GET请求和POST请求的区别
从三个层面来解答
- Http报文层面：GET将请求信息放在URL中，POST放在报文体中
- 数据库层面：GET符合幂等性和安全性，POST不符合
- 其他层面：GET可以被缓存、被存储，而POST不行

3. Cookie和Session的区别
原因Http是无状态的
Cookie简介
- 是由服务器发给客户端的特殊信息，以文本形式存放在客户端
- 客户端再次请求的时候，会把Cookie回发(存放在Http请求头中)
- 服务器收到后，会解析Cookie生成与客户端响应的内容
Cookie的设置以及发送过程
Client ---①HTTP Request---> Server
Client <---②HTTP Response + Set-Cookie--- Server
Client ---③HTTP Request + Cookie---> Server
Client <---④HTTP Response --- Server

Session简介
- 服务器端的机制，在服务器上保存的信息
- 解析客户端请求并操作session id，按需保存状态信息

Session的实现方式
- 使用Cookie来实现
- 使用URL回写来实现

区别
- Cookie数据存放在客户的浏览器上，Session数据放在服务器上
- Session相对于Cookie更安全
- 若考虑减轻服务器负担，应当使用Cookie


4. HTTP和HTTPS的区别

HTTP

| HTTP |
| -- |
| TCP |
| IP |

HTTPS

| HTTP |
| -- |
|SSL or TLS |
| TCP |
| IP |

SSL(Security Sockets Layer) 安全套接层
- 为网络通信提供安全数据完整性的一种安全协议
- 是操作系统对外的API，SSL3.0后更名为TLS
- 采用身份验证和数据加秘保证网络通信的安全和数据的完整性 

加密的方式
- 对称加密：加密和解密都是用同一个密钥
- 非对称加密：加密使用的密钥和解密使用的密钥是不相同的
- 哈希算法：将任意长度的信息转换为固定长度的指，算法不可逆
- 数字签名：证明某个消息或者文件时某人发出/认同的

HTTPS数据传输流程、
- 浏览器将支持的加密算法信息发送给服务器
- 服务器选择一套浏览器支持的加密算法，以证书的形式回发浏览器
- 浏览器验证整数合法性，并结合整数公钥加密信息发送给服务器
- 服务器使用私钥解密信息，验证哈希，加密响应信息回发浏览器
- 浏览器解密响应消息，并对消息进行验证之后进行加密交互数据

回答：
- HTTPS需要到CA申请证书，HTTP不需要
- HTTPS密文传输，HTTP铭文传输
- 连接方式不同，HTTPS默认使用443端口，HTTP使用80端口
- HTTPS = HTTP + 加密 + 认证 + 完整性保护，较HTTP安全

HTTPS真的安全吗？
- 浏览器默认填充http://，请求需要进行跳转，有被劫持的风险
- 可以使用HSTS(HTTP Strict Transport Security)的优化
