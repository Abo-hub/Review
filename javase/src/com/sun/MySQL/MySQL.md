# 数据库

## 一 数据库架构

面试题
1. 如何设计一个关系型数据库
![mysql](/imgs/mysql.png)

Interview question

### 索引模块
常见问题
- 为什么使用索引
因为索引可以让我们避免全表扫描去查找数据，提升检索效率
- 什么样的信息能成为索引
主键、唯一键等只要是能让数据具备一定区分性的字段都可以称为索引
- 索引的数据结构

- 密集索引和稀疏索引的区别

 

#### 为什么使用索引
 - 快速查询数据


#### 什么样的信息能成为索引
- 主键、唯一键以及普通键

#### 索引的数据结构
- 生成索引，建立二叉查找树进行二分查找
- 生成索引，建立B-Tree结构进行查找
- 生成索引，建立B+-Tree结构 进行查找
- 生成索引，建立Hash结构进行查找

#### B-Tree
- 根节点至少包括两个孩子
- 书中每个节点最多含有m个孩子(m>=2)
- 除根节点和叶节点外，其每个节点至少有ceil(m/2)个孩子
- 所有叶子节点都位于同一层

#### Hash索引
缺点
- 仅仅能满足"=","IN",不能使用范围查询
- 无法被用来避免数据的排序操作
- 不能利用部分索引键查询
- 不能避免表扫描
- 会产生Hash冲突


#### 密集索引和稀疏索引的区别 
- 密集索引文件中的每个搜索吗值都对运营一个索引值
- 稀疏索引文件职位索引码的某些值建立索引项

InnoDB 只有密集索引
- 若一个主键被定义，该主键则作为密集索引
- 若没有主键被定义，该表演的第一个唯一索引非空索引则作为密集索引
- 若不满足以上条件，innodb内部会生成一个隐藏主键(密集索引)
- 非主键索引存储相关键位和其对应的主键值，包含两次查找

面试题：
1. 如何定位并优化慢查询Sql
    1. 根据慢日志定位慢查询sql
    2. 使用explain等更具分析sql
        关键字段 
        - type：(如果是index，all则需要优化)
        - extra：(如果出现以下2项意味着MYSQL根本不能使用索引，效率会受到重大影响。应尽可能进行优化)
            - Using filsort：表示MySQL会对结果使用一个外部索引排序，而不是从表里按索引次读到相关到内容。可能在内存或者磁盘上进行排序。MySql中无法利用索引你完成的排序操作称为"文件排序"
            - Using temporary：表示MySQL在对查询结果排序时使用临时表。常见于排序order by和分组查询group by
    3. 修改sql或者尽量让sql走索引



2. 联合索引的最左匹配原则的成因
    1. 最左前缀匹配原则。mysql会一直向右匹配直到遇到范围查询(>、<、between、like)就并停止匹配。比如a=3 and b=4 and c<5 and d=6如果建立(a,b,c,d)顺序的索引，d时不会用到索引的，如果建立(a,b,d,c)的索引则可以用到，a,b,d的顺序可以任意调整。

    2. =和in 可以乱序，比如a=1 and b=2 and c=3建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式


3. 索引是建立越多越好吗
- 数据量小的表不需要建立索引，建立会增加额外的索引开销
- 数据变更需要维护索引，因此更多的索引意味着更多的维护成本
- 更多的索引意味着也需要更多的空间

### 锁模块
 
常见问题
- MyISAMY与InnoDB关于所方面的区别是什么
- 数据库事务的四大特性
- 事务隔离级别以及各级别下的并发访问问题
- InnoDB可重复度隔离级别下如果避免幻读
- RC、RR级别下的InnoDB的非阻塞读如何实现
 
#### MyISAMY与InnoDB关于所方面的区别是什么
- MyISAM默认使用的表级锁，不支持行级锁
- InnoDB默认用的是行级锁，也支持表级锁




